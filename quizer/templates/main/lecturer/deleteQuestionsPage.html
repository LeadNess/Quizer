{% extends "main/lecturerWrapper.html" %}

{% block content %}

{% load main_extras %}

 	<div class='jumbotron'>
 		<h2>Вопросы к тесту {{ test.name }}</h2><br>
 		<p>Чтобы удалить вопросы, выделите их в списке вопросов и нажмите 'Удалить'.</p>
 		<div class="form-row">
	  		<div class="col-md-4 mb-3">
		  		<label>Фильтр по формулировке
		      		<input type="text" class="form-control" id="name_filter" name="name_filter">
		      	</label>
	  		</div>
	    </div>
 		<form action="" method="post">
			{% csrf_token %}
		    Вопросы
		    <ul id="questions_container" class="list-group"></ul>
		    <script type="text/javascript">
		    	function getLiElement(i) {
		    		const li = document.createElement('li');
    				li.className = "list-group-item";

    				const checkboxContainer = document.createElement('div');
					checkboxContainer.className = 'custom-control custom-checkbox my-1 mr-sm-2';

					const input = document.createElement('input');
					input.className = "custom-control-input"
					input.type = 'checkbox';
					input.id = questions[i]._id;
					input.name = questions[i].formulation;

					const label = document.createElement('label');
					label.className = 'custom-control-label'
					label.htmlFor = questions[i]._id;
					label.innerHTML = `${questions[i].formulation}`;

					checkboxContainer.appendChild(input);
					checkboxContainer.appendChild(label);

					li.appendChild(checkboxContainer);
					return li;
		    	}
		    	const q = '{{ questions }}';
		    	const questions = JSON.parse(q
			        .replace(/&quot;/gi, '"')
			        .replace(/True/gi, 'true')
			        .replace(/False/gi, 'false')
			        .replace(/None/gi, 'null'));
		    	const questionsContainer = document.getElementById("questions_container");
		    	for (let i = 0; i < questions.length; ++i) {
		    			questionsContainer.appendChild(getLiElement(i));
		    		}

		    	const nameFilter = document.getElementById("name_filter");
		    	nameFilter.onkeyup = nameFilter.onchange = () =>  {
		    		questionsContainer.innerHTML = '';
		    		for (let i = 0; i < questions.length; ++i) {
		    			if (questions[i].formulation.includes(nameFilter.value)) {
		    				questionsContainer.appendChild(getLiElement(i));
		    			}
		    		}
		    	};
		    </script>
        	<br>
		    <button class="btn btn-danger" type="submit"><img src='{% delete_icon %}'> Удалить</button>
		    <input type="hidden" name="test_id" id="test_id" value="{{ test.id }}">
		</form>
 	</div>
{% endblock %}
