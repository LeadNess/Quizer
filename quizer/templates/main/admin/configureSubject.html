{% extends "main/lecturerWrapper.html" %}

{% block content %}

{% load static %}
{% load main_extras %}

<link rel="stylesheet" href="{% static 'main/css/modal-window.css' %}">

<div class='jumbotron'>
    <h2>Учебные предметы</h2><br>
    <p>Здесь отображаются учебные предметы, добавленные в систему.</p>
    <div class="btn-group mr-2">
        <button class="btn btn-success js-open-modal" data-modal="add-modal" onclick='clearForms()'><img src='{% add_icon %}'> Добавить предмет</button>
    </div>
    <div class="btn-group mr-2">
        <button class="btn btn-success js-open-modal" data-modal="load-modal" onclick='clearForms()'><img src='{% download_icon %}'> Загрузить предмет</button>
    </div>
    {% for subject, tests_count in subjects %}
    <hr class="my-4">
    <h3>{{ subject.name }}</h3>
    <p>{{ subject.description }}</p>
    <p><img src='{% database_icon %}'> Тестов к предмету: {{ tests_count }}<br>
    <div class="btn-group mr-2">
        <a class="btn btn-primary" href="{% url 'main:edit_subject' subject.id %}"><img src="{% edit_icon %}"> Редактировать</a>
    </div>
    <div class="btn-group mr-2">
        <a class="btn btn-danger" href="{% url 'main:delete_subject' subject.id %}"><img src="{% delete_icon %}"> Удалить</a>
    </div>
    {% endfor %}
</div>

<div class="modal-window" data-modal="add-modal">
   <img class="modal__cross js-modal-close" src="{% close_icon %}">
   <h4>Новый предмет</h4>
   <hr class="my hr4">
   <form action="{% url 'main:add_subject_result' %}" method="post">
        <div>
            {% csrf_token %}
            <input type="hidden" name="subject_id" id="subject_id" value="{{ subject.id }}">
              <div class="form-row">
                <div class="col-md-4 mb-3">
                    <label for="name">Название предмета
                        <input type="text" class="form-control" id="subjectName" name="name" value="" required>
                    </label>
                </div>
              </div>
              <div class="form-row">
                 <div class="col-md-4 mb-3">
                  <label for="description">Описание</label>
                  <textarea class="form-control" rows="3" cols="30" id="description" name="description"></textarea>
                </div>
              </div>
        </div>
       <div class="modal-footer">
            <button type="button" class="btn btn-primary js-modal-close"><img class="js-modal-close" src="{% cancel_icon %}"> Закрыть</button>
            <button class="btn btn-success" type="submit"><img src='{% add_icon %}'> Добавить</button>
       </div>
    </form>
</div>

<div class="modal-window" data-modal="load-modal">
   <img class="modal__cross js-modal-close" src="{% close_icon %}">
   <h4>Загрузить предмет</h4>
   <hr class="my hr4">
   <form action="{% url 'main:load_subject_result' %}" enctype="multipart/form-data" method="post">
   {% csrf_token %}
      <div>
       <div>Выберите папку с тестами к предмету:
            <input type="file" id="FileUpload" name='tests' onchange="selectFolder(event)" webkitdirectory mozdirectory msdirectory odirectory directory multiple />
            <input type="hidden" id="filesNames" name='files_names' value="">
       </div>
        <hr>
          <div class="form-row">
            <div class="col-md-4 mb-3">
                <label for="name">Название предмета
                    <input type="text" class="form-control" id="subjectName" name="name" value="" required>
                </label>
            </div>
          </div>
          <div class="form-row">
             <div class="col-md-4 mb-3">
              <label for="description">Описание</label>
              <textarea class="form-control" rows="3" cols="30" id="subjectDescription" name="description"></textarea>
            </div>
          </div>
      </div>
     <div class="modal-footer">
          <button type="button" class="btn btn-primary js-modal-close"><img class="js-modal-close" src="{% cancel_icon %}"> Закрыть</button>
          <button class="btn btn-success" type="submit"><img src='{% download_icon %}'> Загрузить</button>
     </div>
   </form>
</div>
<div class="overlay js-overlay-modal"></div>

<script src="{% static 'main/js/modalWindow.js' %}"></script>
<script type="text/javascript">
    function clearForms(el) {
        const elements = document.getElementsByClassName('form-control');
        for (const element of elements) {
            element.value = '';
        }
    }

    function selectFolder(e) {
        let theFiles = e.target.files;
        let relativePath = theFiles[0].webkitRelativePath;
        let folder = relativePath.split("/");
        let filesStr = '';
        for (let filePath of theFiles) {
            filesStr += (filePath.name.split('.')[0] + '<separator>');
        }
        document.querySelector('input#filesNames').value = filesStr.substr(0, filesStr.length - 11);
        document.querySelector('input#subjectName.form-control').value = folder[0];

    }
</script> 

{% endblock %}